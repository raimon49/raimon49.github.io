<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="継続的にMarkdownファイルの構文チェックを実施させたい時はRubyのMarkdown lint tool（以降「Markdownlint」）を利用する。 Lint設定の変更方法や、CIサービスとの連携方法についてまとめる。 インストール MarkdownlintはRubyGemsで公開・配布されているため gem または bundle コマンドを用いてインストールする。 例えば...">
        <meta name="keywords" content="CI, Git, Markdown, Ruby">
        <link rel="icon" href="https://raimon49.github.io/favicon.ico">
        <!-- Canonical -->
        <link rel="canonical" href="https://raimon49.github.io/2017/10/29/lint-markdown-with-ruby-gems.html">
        <!-- /Canonical -->

        <title>Markdown lint toolでMarkdownファイルの構文のLintをチェック - Steel Dragon 14106</title>

        <!-- Stylesheets -->
        <link href="https://raimon49.github.io/theme/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://raimon49.github.io/theme/css/fonts.css" rel="stylesheet">
        <link href="https://raimon49.github.io/theme/css/nest.css" rel="stylesheet">
        <link href="https://raimon49.github.io/theme/css/pygment.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="https://raimon49.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Steel Dragon 14106 Full RSS Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->



    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="https://raimon49.github.io/"><img class="mr20" src="https://raimon49.github.io/images/exchange32.png" alt="logo">Steel Dragon 14106</a>
                    </div>
                    <div class="nav pull-right">
                                <a href="https://raimon49.github.io/categories.html">Categories</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">Markdown lint toolでMarkdownファイルの構文のLintをチェック</h1>
                      <p class="header-date">By <a href="https://raimon49.github.io/author/raimon.html">raimon</a>, 2017-10-29(日), in category <a href="https://raimon49.github.io/category/ruby.html">Ruby</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="https://raimon49.github.io/tag/ci.html">CI</a>, <a href="https://raimon49.github.io/tag/git.html">Git</a>, <a href="https://raimon49.github.io/tag/markdown.html">Markdown</a>, <a href="https://raimon49.github.io/tag/ruby.html">Ruby</a>                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>継続的にMarkdownファイルの構文チェックを実施させたい時はRubyの<a href="https://github.com/markdownlint/markdownlint">Markdown lint tool</a>（以降「Markdownlint」）を利用する。</p>
<p>Lint設定の変更方法や、CIサービスとの連携方法についてまとめる。</p>
<h2>インストール</h2>
<p>MarkdownlintはRubyGemsで公開・配布されているため <code>gem</code> または <code>bundle</code> コマンドを用いてインストールする。</p>
<p>例えば <code>bundle</code> であれば、次のように <code>Gemfile</code> にRubyGemsでの公開名「mdl」を記述する。</p>
<div class="highlight"><pre><span></span><code><span class="n">source</span><span class="w"> </span><span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span><span class="w"> </span><span class="s1">&#39;mdl&#39;</span>
</code></pre></div>

<p>Bundlerでローカル環境にインストールする。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>bundle<span class="w"> </span>install<span class="w"> </span>--path<span class="w"> </span>vendor/bundle
</code></pre></div>

<p>インストール後、Bundlerを通して <code>mdl</code> コマンドがローカル環境で実行可能になる。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>bundle<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>mdl<span class="w"> </span>--help
Usage:<span class="w"> </span>mdl<span class="w"> </span><span class="o">[</span>options<span class="o">]</span><span class="w"> </span><span class="o">[</span>FILE.md<span class="p">|</span>DIR<span class="w"> </span>...<span class="o">]</span>
<span class="w">    </span>-c,<span class="w"> </span>--config<span class="w"> </span>FILE<span class="w">                </span>The<span class="w"> </span>configuration<span class="w"> </span>file<span class="w"> </span>to<span class="w"> </span>use
<span class="w">    </span>-g,<span class="w"> </span>--git-recurse<span class="w">                </span>Only<span class="w"> </span>process<span class="w"> </span>files<span class="w"> </span>known<span class="w"> </span>to<span class="w"> </span>git<span class="w"> </span>when<span class="w"> </span>given<span class="w"> </span>a<span class="w"> </span>directory
<span class="w">    </span>-i,<span class="w"> </span>--<span class="o">[</span>no-<span class="o">]</span>ignore-front-matter<span class="w">   </span>Ignore<span class="w"> </span>YAML<span class="w"> </span>front<span class="w"> </span>matter
<span class="w">    </span>-l,<span class="w"> </span>--list-rules<span class="w">                 </span>Don<span class="s1">&#39;t process any files, just list enabled rules</span>
<span class="s1">    -r, --rules RULE1,RULE2          Only process these rules</span>
<span class="s1">    -u, --rulesets RULESET1,RULESET2 Specify additional ruleset files to load</span>
<span class="s1">    -a, --[no-]show-aliases          Show rule alias instead of rule ID when viewing rules</span>
<span class="s1">    -w, --[no-]warnings              Show kramdown warnings</span>
<span class="s1">    -d, --skip-default-ruleset       Don&#39;</span>t<span class="w"> </span>load<span class="w"> </span>the<span class="w"> </span>default<span class="w"> </span>markdownlint<span class="w"> </span>ruleset
<span class="w">    </span>-s,<span class="w"> </span>--style<span class="w"> </span>STYLE<span class="w">                </span>Load<span class="w"> </span>the<span class="w"> </span>given<span class="w"> </span>style
<span class="w">    </span>-t,<span class="w"> </span>--tags<span class="w"> </span>TAG1,TAG2<span class="w">             </span>Only<span class="w"> </span>process<span class="w"> </span>rules<span class="w"> </span>with<span class="w"> </span>these<span class="w"> </span>tags
<span class="w">    </span>-v,<span class="w"> </span>--<span class="o">[</span>no-<span class="o">]</span>verbose<span class="w">               </span>Increase<span class="w"> </span>verbosity
<span class="w">    </span>-h,<span class="w"> </span>--help<span class="w">                       </span>Show<span class="w"> </span>this<span class="w"> </span>message
<span class="w">    </span>-V,<span class="w"> </span>--version<span class="w">                    </span>Show<span class="w"> </span>version
</code></pre></div>

<h2>リンティングの実行</h2>
<p>リンティングの実行は、 <code>mdl</code> コマンドの引数として、Markdownファイルや文書の存在するディレクトリ名を渡すだけである。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>bundle<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>mdl<span class="w"> </span>docs
</code></pre></div>

<p>この時、Markdownlintのチェック設定として、<a href="https://github.com/markdownlint/markdownlint/blob/master/docs/RULES.md">ツール側の推奨するルール</a>が適用される。</p>
<p>例えば、推奨ルールではリストのインデントにおいて2 spacesを推奨しているため、4 spacesやハードタブを採用しているMarkdown文書では、次のようなエラーが検出される。</p>
<div class="highlight"><pre><span></span><code>MD007<span class="w"> </span>Unordered<span class="w"> </span>list<span class="w"> </span>indentation
</code></pre></div>

<h2>Lintルールの無視設定やカスタマイズ</h2>
<p>自分達のプロジェクトで採用するルールと合わなくて無視したい場合は <code>mdlrc</code> というファイルを作成し、無視したいルール名を <code>~</code> （チルダ）で明示する。</p>
<div class="highlight"><pre><span></span><code>rules<span class="w"> </span><span class="s2">&quot;~MD007&quot;</span>
</code></pre></div>

<p>そしてリンティング実行時に上記の設定ファイルを <code>-c</code> オプションに指定すれば良い。複数のルール名を記述したい場合はカンマ区切りで並べれば全てのルールについて有効/無効を指定できる。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>bundle<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>mdl<span class="w"> </span>-c<span class="w"> </span>mdlrc<span class="w"> </span>docs
</code></pre></div>

<p>デフォルトの推奨ルールを全て継承した上で、特定のルールだけ設定を変えたい場合は <code>style.rb</code> のようなファイルを作成する。例えばリストのインデントを4 spacesだったら正としてチェックさせたい時は、次の内容となる。</p>
<div class="highlight"><pre><span></span><code><span class="n">all</span>
<span class="n">rule</span><span class="w"> </span><span class="s1">&#39;MD007&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">:indent</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">4</span>
</code></pre></div>

<p>リンティング実行時には、このスタイルファイルを <code>-s</code> オプションに指定する。スタイルファイルの詳細は<a href="https://github.com/markdownlint/markdownlint/blob/master/docs/creating_styles.md">Creating styles</a>を参照のこと。</p>
<h2>CIサービスで自動実行させる</h2>
<p>ローカル環境でだけMarkdownファイルをチェックできるだけでも助かるのだが、やはりCIサービスと連携して自動実行させたい。</p>
<p>Travis CIであれば、CI設定ファイル <code>.travis.yml</code> は次のような内容になるだろう。無視設定やスタイル設定は <code>script:</code> のコマンド行で各々のプロジェクトに合わせて指定させると良い。ここでは例として、先に挙げた4 spaces indentのスタイル設定ルールを採用して自動チェックさせる。</p>
<div class="highlight"><pre><span></span><code><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ruby</span>
<span class="nt">rvm</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.4</span>
<span class="nt">script</span><span class="p">:</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">bundle exec mdl -s style.rb docs</span>
</code></pre></div>

<p>サンプルとして、このCI設定ファイルを使ってTravis CIと連携し、<a href="https://github.com/raimon49/use-markdownlint-sample/pull/1">Pull Requestを投げたら自動でルール違反が検出され、修正後にCIジョブをPassしてマージされるまでの流れ</a>を記録に残した。</p>
<p>また、この記事を書いて以降、CIサービスの主流はGitHub Actionsに移行しつつあるため、ActionsでのCI設定ファイルも例として記載しておく。</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ruby</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">master</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">master</span><span class="w"> </span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>

<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ruby-version</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;2.6&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;2.7&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;3.0&#39;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Ruby</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ruby/setup-ruby@v1</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">ruby-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.ruby-version }}</span>
<span class="w">        </span><span class="nt">bundler-cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># runs &#39;bundle install&#39; and caches installed gems automatically</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run tests</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bundle exec mdl -s style.rb docs</span>
</code></pre></div>

<h2>まとめ</h2>
<ul>
<li>MarkdownのLintにはRubyGemsで公開・配布されているMarkdown lint toolが活用できる</li>
<li>デフォルトルールで無視したい設定は <code>mdlrc</code> で、カスタマイズしたいスタイル設定は <code>style.rb</code> で指定できる</li>
<li>CIサービスと連携することで、ブランチやPull Requestの内容を自動チェックできる<ul>
<li>このエントリでは、Travis CIとGitHub Actionsの設定例を書いた</li>
</ul>
</li>
</ul>
<h2>他の実装</h2>
<ul>
<li>Python実装として<a href="https://github.com/jorisroovers/pymarkdownlint">pymarkdownlint</a>が存在するが、Ruby版の移植途中で作者が止めてしまったらしく、何年もメンテナンスされていない。</li>
<li>Node（JavaScript）実装として<a href="https://github.com/DavidAnson/markdownlint">markdownlint</a>が存在する。こちらはRuby版の移植として2017年10月現在もメンテナンスされている。<ul>
<li>やや古い内容にあるが<a href="/2015/05/01/lint-markdown-at-commit.html">2015年に本ブログでも取り上げている</a>ので参考にされたい。</li>
</ul>
</li>
</ul>


    <div class="comments">
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'steeldragon14106';
                var disqus_identifier = '2017/10/29/lint-markdown-with-ruby-gems.html';
                var disqus_url = 'https://raimon49.github.io/2017/10/29/lint-markdown-with-ruby-gems.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
        <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>
        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="https://raimon49.github.io/archives.html">Archives</a></li>
                            <li><a href="https://raimon49.github.io/tags.html">Tags</a></li>
                            <li><a href="https://raimon49.github.io/authors.html">Authors</a></li>
                            <li><a href="https://raimon49.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">RSS Feed</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Social</div>
                        <ul class="list-unstyled">
                            <li><a href="https://github.com/raimon49" target="_blank">GitHub</a></li>
                            <li><a href="https://twitter.com/raimon49" target="_blank">Twitter</a></li>
                            <li><a href="https://www.last.fm/user/raimon_49" target="_blank">Last.fm</a></li>
                            <li><a href="http://sangoukan.xrea.jp/" target="_blank">Website</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Links</div>
                        <ul class="list-unstyled">
                            <li><a href="https://raimon49.github.io/my-portfolio/" target="_blank">Information about raimon</a></li>
                            <li><a href="https://blog.getpelican.com/" target="_blank">Pelican</a></li>
                            <li><a href="https://www.python.org/" target="_blank">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/" target="_blank">Jinja2</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; raimon 2014-2019</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>